---
author: brainstorm
categories:
- Uncategorized
date: '2013-05-19T14:00:00.000000+00:00'
dsq_thread_id:
- 2874890289
excerpt: null
layout: post
modified: '2013-05-19T14:00:00.000000+00:00'
openid_comments:
- a:1:{i:0;i:11458;}
permalink: https://blogs.nopcode.org/brainstorm/2013/05/20/pragmatic-python-versioning-via-setuptools-and-git-tags/
tags:
- howto
- python
- software
- uppnex
title: Pragmatic Python versioning via setuptools and git tags
---

Some <acronym title="Python Enhancement Proposal">PEP</acronym>&#8216;s have [revolved][1] [around][2] the problem of software versioning and [dependency tracking][3].

So, in addition to having some blueprints such as those proposed by the [Semantic Versioning][4] guidelines, one needs specifics on how to integrate those practices in our day to day work with version control systems.

Setuptools saves the day by introducing versioning via [git tags][5]. In a post by [Douglas Creager][6] a strategy to use setuptools with git tags is devised. The workflow for tagging a new version results in:

1.  Tag your release via *git tag* if the changes are significant.
2.  Run python setup.py install, to bump the version on the filesystem.
3.  git push.

The following code makes it happen:

<pre class="brush: python; title: ; notranslate" title=""># Fetch version from git tags, and write to version.py.
# Also, when git is not available (PyPi package), use stored version.py.
version_py = os.path.join(os.path.dirname(__file__), 'version.py')

try:
    version_git = subprocess.check_output(["git", "describe"]).rstrip()
except:
    with open(version_py, 'r') as fh:
        version_git = open(version_py).read().strip().split('=')[-1].replace('"','')

version_msg = "# Do not edit this file, pipeline versioning is governed by git tags"
with open(version_py, 'w') as fh:
    fh.write(version_msg + os.linesep + "__version__=" + version_git)

setup(name="yourpythonpackage",
      version="{ver}".format(ver=version_git),
</pre>

As an addition to the git tags workflow proposed by Douglas, the &#8216;\_\_version\_\_' attribute will be stored in version.py file. This allows the versions to be tracked even when our git repository is not available (i.e, via PyPi package installation), or when such a version needs to be queried from inside your own package.

Thanks [Guillermo][7] and [Brad][8] for the feedback and suggestions on this strategy.

 [1]: http://www.python.org/dev/peps/pep-0386/
 [2]: http://www.python.org/dev/peps/pep-0413/
 [3]: http://www.python.org/dev/peps/pep-0440/
 [4]: http://semver.org/
 [5]: http://learn.github.com/p/tagging.html
 [6]: http://dcreager.net/2010/02/10/setuptools-git-version-numbers/
 [7]: http://mussolblog.wordpress.com/
 [8]: http://bcbio.wordpress.com/